{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/autoCatalog.ts","../../src/node/locales.ts","../../src/node/plugin.ts"],"sourcesContent":["import { getDirname, path } from \"@vuepress/utils\";\nimport { Logger, ensureEndingSlash } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const PLUGIN_NAME = \"vuepress-plugin-auto-catalog\";\n\nexport const logger = new Logger(PLUGIN_NAME);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\")\n);\n","import { type App, type PageFrontmatter, createPage } from \"@vuepress/core\";\nimport { getTitleFromFilename } from \"vuepress-shared/node\";\n\nimport { type AutoCatalogOptions } from \"./options.js\";\nimport { logger } from \"./utils.js\";\n\nexport const injectCatalogInformation = (\n  { pages }: App,\n  {\n    component,\n    iconGetter,\n    iconRouteMetaKey = \"i\",\n    shouldIndex,\n    indexRouteMetaKey = \"I\",\n    orderGetter,\n    orderRouteMetaKey = \"O\",\n    titleGetter = (page): string => page.title,\n    titleRouteMetaKey = \"title\",\n  }: AutoCatalogOptions\n): void => {\n  if (!component)\n    pages.forEach((page) => {\n      const data: Record<string, unknown> = {};\n\n      const pageTitle = titleGetter?.(page);\n      const pageIcon = iconGetter?.(page);\n      const pageIndex = shouldIndex?.(page) ?? null;\n      const pageOrder = orderGetter?.(page) ?? null;\n\n      if (pageTitle) data[titleRouteMetaKey] = pageTitle;\n      if (pageIcon) data[iconRouteMetaKey] = pageIcon;\n      if (typeof pageIndex === \"boolean\")\n        data[indexRouteMetaKey] = pageIndex ? 1 : 0;\n      if (typeof pageOrder === \"number\") data[orderRouteMetaKey] = pageOrder;\n\n      page.routeMeta = { ...page.routeMeta, ...data };\n    });\n};\n\nexport const generateCatalog = async (\n  app: App,\n  {\n    component = \"AutoCatalog\",\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    iconComponent,\n    level = 3,\n    index = false,\n  }: AutoCatalogOptions\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app;\n\n  const pathToBeGenerated = new Set<string>();\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : \"\"}${\n    index ? \" index\" : \"\"\n  }>\\\n${\n  iconComponent\n    ? `\n  <template #icon=\"{ icon }\">\n    <${iconComponent} :icon=\"icon\" />\n  </template>\n`\n    : \"\"\n}\\\n</${component}>\n`;\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath;\n\n    // not 404 page\n    if (pagePath !== \"/404.html\")\n      while (catalogPath !== pathLocale) {\n        catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, \"/\");\n\n        if (\n          // not discovered yet\n          !pathToBeGenerated.has(catalogPath) &&\n          // not being excluded\n          exclude.every((pattern) => !catalogPath.match(pattern)) &&\n          // path not found\n          pages.every(({ path }) => path !== catalogPath)\n        ) {\n          if (isDebug) logger.info(`Generating catalog ${catalogPath}}`);\n\n          pathToBeGenerated.add(catalogPath);\n        }\n      }\n  });\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map((path) => {\n        const [, basename = \"\"] = /\\/([^/]+)\\/?$/.exec(path) || [];\n        const title = getTitleFromFilename(basename);\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...(frontmatter(path) || {}),\n          },\n          content,\n          path,\n        });\n      })\n  ).then((pages) => {\n    app.pages.push(...pages);\n  });\n};\n","import { type AutoCatalogLocaleConfig } from \"../shared/index.js\";\n\nexport const locales: AutoCatalogLocaleConfig = {\n  \"/en/\": {\n    title: \"Catalog\",\n  },\n\n  \"/zh/\": {\n    title: \"目录\",\n  },\n\n  \"/zh-tw/\": {\n    title: \"目錄\",\n  },\n\n  \"/de/\": {\n    title: \"Katalog\",\n  },\n\n  \"/de-at/\": {\n    title: \"Katalog\",\n  },\n\n  \"/vi/\": {\n    title: \"Danh mục\",\n  },\n\n  \"/uk/\": {\n    title: \"Каталог\",\n  },\n\n  \"/ru/\": {\n    title: \"Каталог\",\n  },\n\n  \"/br/\": {\n    title: \"Catálogo\",\n  },\n\n  \"/pl/\": {\n    title: \"Katalog\",\n  },\n\n  \"/sk/\": {\n    title: \"Katalóg\",\n  },\n\n  \"/fr/\": {\n    title: \"Catalogue\",\n  },\n\n  \"/es/\": {\n    title: \"Catálogo\",\n  },\n\n  \"/ja/\": {\n    title: \"カタログ\",\n  },\n\n  \"/tr/\": {\n    title: \"Katalog\",\n  },\n\n  \"/ko/\": {\n    title: \"목차\",\n  },\n\n  \"/fi/\": {\n    title: \"Luettelo\",\n  },\n\n  \"/hu/\": {\n    title: \"Katalógus\",\n  },\n\n  \"/id/\": {\n    title: \"Katalog\",\n  },\n\n  \"/nl/\": {\n    title: \"Catalogus\",\n  },\n};\n","import { type PluginFunction } from \"@vuepress/core\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport { checkVersion, getLocales } from \"vuepress-shared/node\";\n\nimport { generateCatalog, injectCatalogInformation } from \"./autoCatalog.js\";\nimport { locales as defaultLocales } from \"./locales.js\";\nimport { type AutoCatalogOptions } from \"./options.js\";\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from \"./utils.js\";\n\nexport const autoCatalogPlugin =\n  (options: AutoCatalogOptions = {}): PluginFunction =>\n  (app) => {\n    checkVersion(app, PLUGIN_NAME, \"2.0.0-beta.61\");\n\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    const {\n      component,\n      iconComponent,\n      iconRouteMetaKey = \"i\",\n      indexRouteMetaKey = \"I\",\n      locales,\n      orderRouteMetaKey = \"O\",\n      titleRouteMetaKey = \"title\",\n    } = options;\n\n    return {\n      name: PLUGIN_NAME,\n\n      define: (): Record<string, unknown> => ({\n        AUTO_CATALOG_LOCALES: getLocales({\n          app,\n          name: PLUGIN_NAME,\n          default: defaultLocales,\n          config: locales,\n        }),\n        AUTO_CATALOG_ICON_COMPONENT: iconComponent || \"\",\n        AUTO_CATALOG_TITLE_META_KEY: titleRouteMetaKey,\n        AUTO_CATALOG_ICON_META_KEY: iconRouteMetaKey,\n        AUTO_CATALOG_ORDER_META_KEY: orderRouteMetaKey,\n        AUTO_CATALOG_INDEX_META_KEY: indexRouteMetaKey,\n      }),\n\n      onInitialized: async (app): Promise<void> => {\n        injectCatalogInformation(app, options);\n        await generateCatalog(app, options);\n      },\n\n      ...(component ? {} : { clientConfigFile: `${CLIENT_FOLDER}config.js` }),\n    };\n  };\n"],"names":["__dirname","getDirname","PLUGIN_NAME","logger","Logger","CLIENT_FOLDER","ensureEndingSlash","path","injectCatalogInformation","pages","component","iconGetter","iconRouteMetaKey","shouldIndex","indexRouteMetaKey","orderGetter","orderRouteMetaKey","titleGetter","page","titleRouteMetaKey","data","pageTitle","pageIcon","pageIndex","pageOrder","generateCatalog","app","exclude","frontmatter","iconComponent","level","index","isDebug","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","basename","title","getTitleFromFilename","createPage","locales","autoCatalogPlugin","options","checkVersion","useSassPalettePlugin","getLocales","defaultLocales"],"mappings":"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"}