{"version":3,"file":"ECharts.js","sources":["../../../src/client/components/ECharts.ts"],"sourcesContent":["import { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport { type EChartsOption, type EChartsType } from \"echarts\";\nimport {\n  type PropType,\n  type VNode,\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n} from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport \"../styles/echarts.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\ninterface EchartsConfig {\n  width?: number;\n  height?: number;\n  option: EChartsOption;\n}\n\nconst parseEChartsConfig = (\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __echarts_config__: string,\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __echarts_config_type__: \"js\" | \"json\",\n  // @ts-ignore\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  myChart: EChartsType\n): EchartsConfig => {\n  if (__echarts_config_type__ === \"js\") {\n    // provide globals\n    const exports: Partial<EchartsConfig> = {};\n    const module = { exports };\n\n    // eslint-disable-next-line prefer-const\n    let option: EChartsOption | undefined = undefined;\n    // eslint-disable-next-line prefer-const\n    let width: number | undefined = undefined;\n    // eslint-disable-next-line prefer-const\n    let height: number | undefined = undefined;\n\n    eval(__echarts_config__);\n\n    return <EchartsConfig>{\n      option,\n      width,\n      height,\n      // eslint-disable-next-line import/no-commonjs\n      ...module.exports,\n    };\n  }\n\n  return { option: <EChartsOption>JSON.parse(__echarts_config__) };\n};\n\nexport default defineComponent({\n  name: \"ECharts\",\n\n  props: {\n    /**\n     * echarts config\n     *\n     * 图表配置\n     */\n    config: { type: String, required: true },\n\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Chart title\n     *\n     * 图表标题\n     */\n    title: { type: String, default: \"\" },\n\n    /**\n     * Chart config type\n     *\n     * 图表配置类型\n     */\n    type: { type: String as PropType<\"js\" | \"json\">, default: \"json\" },\n  },\n\n  setup(props) {\n    const loading = ref(true);\n    const echartsContainer = ref<HTMLElement>();\n\n    let chart: EChartsType;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => chart?.resize(), 100)\n    );\n\n    onMounted(() => {\n      void Promise.all([\n        import(/* webpackChunkName: \"echarts\" */ \"echarts\"),\n        // delay\n        new Promise((resolve) => setTimeout(resolve, MARKDOWN_ENHANCE_DELAY)),\n      ]).then(([echarts]) => {\n        chart = echarts.init(echartsContainer.value!);\n\n        const { option, ...size } = parseEChartsConfig(\n          atou(props.config),\n          props.type,\n          chart\n        );\n\n        chart.resize(size);\n        chart.setOption(option);\n\n        loading.value = false;\n      });\n    });\n\n    onUnmounted(() => {\n      chart?.dispose();\n    });\n\n    return (): (VNode | null)[] => [\n      props.title\n        ? h(\"div\", { class: \"echarts-title\" }, decodeURIComponent(props.title))\n        : null,\n      h(\"div\", { class: \"echarts-wrapper\" }, [\n        h(\"div\", {\n          ref: echartsContainer,\n          class: \"echarts-container\",\n          id: props.id,\n        }),\n        loading.value\n          ? h(LoadingIcon, { class: \"echarts-loading\", height: 360 })\n          : null,\n      ]),\n    ];\n  },\n});\n"],"names":["props","loading","echartsContainer","chart","resolve","echarts","option","size"],"mappings":"0MAuBA,MAAM,mBAAqB,CAEzB,mBAEA,wBAGA,UACkB,CAClB,GAAI,0BAA4B,KAAM,CAEpC,MAAM,QAAkC,CAAC,EACnC,OAAS,CAAE,OAAQ,EAGzB,IAAI,OAEA,MAEA,OAEJ,OAAK,KAAA,kBAAkB,EAED,CACpB,OACA,MACA,OAEA,GAAG,OAAO,OACZ,EAGF,MAAO,CAAE,OAAuB,KAAK,MAAM,kBAAkB,CAAE,CACjE,EAEA,IAAA,QAAe,gBAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,OAAQ,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOvC,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,MAAO,CAAE,KAAM,OAAQ,QAAS,EAAG,EAOnC,KAAM,CAAE,KAAM,OAAmC,QAAS,MAAO,CACnE,EAEA,MAAMA,EAAO,CACX,MAAMC,EAAU,IAAI,EAAI,EAClBC,EAAmB,MAEzB,IAAIC,EAEJ,OACE,iBAAA,SACA,cAAc,IAAMA,GAAA,KAAA,OAAAA,EAAO,OAAA,EAAU,GAAG,CAC1C,EAEA,UAAU,IAAM,CACT,QAAQ,IAAI,CACf,OAAyC,SAAS,EAElD,IAAI,QAASC,GAAY,WAAWA,EAAS,sBAAsB,CAAC,CACtE,CAAC,EAAE,KAAK,CAAC,CAACC,CAAO,IAAM,CACrBF,EAAQE,EAAQ,KAAKH,EAAiB,KAAM,EAE5C,KAAM,CAAE,OAAAI,EAAQ,GAAGC,CAAK,EAAI,mBAC1B,KAAKP,EAAM,MAAM,EACjBA,EAAM,IAER,EAEAG,EAAM,OAAOI,CAAI,EACjBJ,EAAM,UAAUG,CAAM,EAEtBL,EAAQ,MAAQ,EAClB,CAAC,CACH,CAAC,EAED,YAAY,IAAM,CAChBE,GAAA,MAAAA,EAAO,QAAA,CACT,CAAC,EAEM,IAAwB,CAC7BH,EAAM,MACF,EAAE,MAAO,CAAE,MAAO,eAAgB,EAAG,mBAAmBA,EAAM,KAAK,CAAC,EACpE,KACJ,EAAE,MAAO,CAAE,MAAO,iBAAkB,EAAG,CACrC,EAAE,MAAO,CACP,IAAKE,EACL,MAAO,oBACP,GAAIF,EAAM,EACZ,CAAC,EACDC,EAAQ,MACJ,EAAE,YAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EACxD,IACN,CAAC,CACH,CACF,CACF,CAAC"}